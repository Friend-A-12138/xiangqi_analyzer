# 中国象棋AI分析器 - 使用指南

## 📚 目录

1. [快速上手](#快速上手)
2. [详细配置](#详细配置)
3. [使用场景](#使用场景)
4. [高级功能](#高级功能)
5. [故障排除](#故障排除)

## 🚀 快速上手

### 场景1: 分析单张图片

1. 启动服务: `python main.py`
2. 打开浏览器访问 http://localhost:5000
3. 登录系统 (admin/admin123)
4. 在"上传图片分析"区域选择图片
5. 点击"分析图片"按钮
6. 查看分析结果和推荐走法

### 场景2: 实时分析模拟器

1. 启动MuMu模拟器，打开JJ象棋
2. 启动分析器服务
3. 访问Web界面并登录
4. 进入"设置"页面
5. 配置:
   - 信号源类型: "模拟器"
   - 模拟器名称: "MuMu"
   - 引擎路径: 你的pikafish.exe路径
6. 保存设置并返回主页
7. 点击"开始分析"按钮
8. 查看实时分析结果

### 场景3: RTMP流分析

1. 设置RTMP推流（如使用OBS）
2. 在设置中选择信号源类型: "RTMP/RTSP流"
3. 输入流地址，如: `rtmp://localhost/live/chess`
4. 开始推流
5. 启动分析
6. 实时查看分析结果

## ⚙️ 详细配置

### Pikafish引擎配置

**Windows示例:**
```
C:\Users\YourName\Downloads\pikafish-windows-x86_64.exe
```

**Linux示例:**
```
/usr/local/bin/pikafish
```

**macOS示例:**
```
/Applications/pikafish.app/Contents/MacOS/pikafish
```

### 信号源配置

#### 模拟器配置

支持的模拟器:
- MuMu模拟器 (默认)
- 雷电模拟器
- BlueStacks
- Nox夜神模拟器
- LDPlayer

**配置示例:**
```json
{
  "source_type": "emulator",
  "source_value": "MuMu"
}
```

#### RTMP流配置

**OBS推流设置:**
1. 设置 → 推流
2. 服务: 自定义
3. 服务器: `rtmp://localhost/live`
4. 串流密钥: `chess`

**分析器配置:**
```json
{
  "source_type": "stream",
  "source_value": "rtmp://localhost/live/chess"
}
```

#### 屏幕截图配置

**区域格式:** `x,y,width,height`

**示例:**
```json
{
  "source_type": "screen",
  "source_value": "100,100,800,600"
}
```

### 分析参数配置

#### 思考时间
- 范围: 500ms - 10000ms
- 推荐: 2000ms
- 说明: 思考时间越长，推荐走法越准确，但响应越慢

#### 分析间隔
- 范围: 1秒 - 10秒
- 推荐: 3秒
- 说明: 两次分析之间的时间间隔，避免过于频繁分析

## 🎯 使用场景

### 在线对局辅助

适合在以下平台使用:
- JJ象棋
- QQ象棋
- 天天象棋
- 其他在线象棋平台

**使用方法:**
1. 打开对局
2. 启动分析器
3. 选择模拟器或屏幕截图模式
4. 查看AI推荐走法

### 棋谱分析

**批量分析:**
1. 准备棋谱图片
2. 使用图片文件模式
3. 逐一上传分析
4. 记录推荐走法

### 教学演示

**实时演示:**
1. 使用RTMP流模式
2. 投影棋盘到屏幕
3. 实时显示分析结果
4. 讲解AI的思路

## 🔧 高级功能

### 内网穿透配置

#### ngrok配置

1. 注册 [ngrok官网](https://ngrok.com/)
2. 获取AuthToken
3. 在设置中配置:
   ```json
   {
     "enable_tunnel": true,
     "tunnel_type": "ngrok",
     "tunnel_config": {
       "auth_token": "your_token_here",
       "region": "ap"
     }
   }
   ```

4. 启动服务后会显示公网URL
5. 其他人可以通过该URL访问

#### frp配置

1. 搭建frp服务器
2. 配置frp客户端
3. 在设置中配置:
   ```json
   {
     "enable_tunnel": true,
     "tunnel_type": "frp",
     "tunnel_config": {
       "server_addr": "your_server.com",
       "server_port": 7000,
       "token": "your_token",
       "subdomain": "chess"
     }
   }
   ```

### 用户管理

**添加用户:**

当前版本支持最多5个用户同时在线。

默认用户:
- admin / admin123 (管理员)
- guest / guest123 (访客)

**用户权限:**
- 可以查看实时分析结果
- 可以修改配置
- 可以上传图片分析

### 命令行启动

**基本启动:**
```bash
python main.py
```

**指定配置:**
```bash
python main.py --config config/my_config.json
```

**指定引擎和信号源:**
```bash
python main.py --engine-path /path/to/pikafish --source-type emulator
```

**启用内网穿透:**
```bash
python main.py --enable-tunnel --tunnel-token YOUR_TOKEN
```

**完整参数:**
```bash
python main.py \
  --engine-path C:/pikafish/pikafish.exe \
  --source-type emulator \
  --source-value "MuMu" \
  --enable-tunnel \
  --tunnel-token your_token \
  --port 8080 \
  --host 0.0.0.0 \
  --no-browser
```

## 🛠️ 故障排除

### 问题1: 引擎无法启动

**现象:** 提示"找不到Pikafish引擎"或"引擎启动失败"

**解决:**
1. 检查引擎文件是否存在
2. 检查引擎路径是否正确
3. 检查引擎是否有执行权限
4. 尝试使用绝对路径

### 问题2: 棋盘检测不准确

**现象:** 棋子识别错误或位置不准确

**解决:**
1. 调整摄像头角度和距离
2. 确保棋盘清晰可见
3. 检查光照条件，避免反光
4. 调整检测参数
5. 确保模型文件完整

### 问题3: 模拟器无法捕获

**现象:** 提示"未找到模拟器窗口"

**解决:**
1. 确保模拟器已启动
2. 检查模拟器窗口标题
3. 尝试使用屏幕截图模式
4. 在设置中手动指定窗口标题

### 问题4: RTMP流连接失败

**现象:** 提示"无法打开视频流"

**解决:**
1. 检查流地址是否正确
2. 检查网络连接
3. 确保推流服务已启动
4. 检查防火墙设置

### 问题5: 内网穿透失败

**现象:** 无法通过公网URL访问

**解决:**
1. 检查认证令牌是否正确
2. 检查网络连接
3. 检查防火墙设置
4. 查看服务提供商状态
5. 尝试更换区域或服务器

### 问题6: Web界面无法访问

**现象:** 浏览器无法打开页面

**解决:**
1. 检查服务是否已启动
2. 检查端口是否被占用
3. 检查防火墙设置
4. 尝试使用其他浏览器
5. 清除浏览器缓存

### 问题7: 分析结果不更新

**现象:** 界面显示"等待分析结果"

**解决:**
1. 检查是否已点击"开始分析"
2. 检查信号源是否正常
3. 检查引擎是否正常运行
4. 查看日志获取详细信息

## 📊 性能优化

### 提高分析速度

1. **减少思考时间**: 从2000ms降低到1000ms
2. **增大分析间隔**: 从3秒增加到5秒
3. **使用GPU加速**: 如果支持的话

### 提高准确性

1. **增加思考时间**: 从2000ms增加到5000ms
2. **提高图像质量**: 使用高清摄像头
3. **优化光照**: 确保光线充足且均匀

### 降低资源占用

1. **减少分析频率**: 增大分析间隔
2. **关闭预览**: 在设置中关闭实时预览
3. **限制用户数量**: 减少同时在线用户数

## 🔒 安全建议

1. **修改默认密码**: 生产环境中务必修改默认密码
2. **限制访问**: 使用内网穿透时注意访问控制
3. **定期更新**: 及时更新软件和依赖
4. **日志审计**: 定期检查日志文件
5. **备份配置**: 定期备份配置文件

## 📞 获取帮助

- 查看日志文件: `logs/xiangqi_analyzer.log`
- 提交Issue到GitHub
- 查阅完整文档: `README.md`

---

**祝你使用愉快！**